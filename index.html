<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Biskut</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #0f0f1a;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      /* Animated Platformer Background */
      .platformer-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 200%;
        height: 200%;
        z-index: -1;
        opacity: 0.15;
        animation: parallaxScroll 30s linear infinite;
      }

      @keyframes parallaxScroll {
        0% { transform: translate(-25%, -25%); }
        100% { transform: translate(-75%, -75%); }
      }

      /* Complex Platformer Elements */
      .platform {
        position: absolute;
        background: linear-gradient(45deg, #2a1810, #4a2820);
        border: 2px solid #8b4513;
        box-shadow: inset 0 2px 4px rgba(255,255,255,0.1), 0 4px 8px rgba(0,0,0,0.3);
      }

      .platform::before {
        content: '';
        position: absolute;
        top: -2px;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #cd853f, #daa520, #cd853f);
        animation: platformGlow 3s ease-in-out infinite alternate;
      }

      @keyframes platformGlow {
        0% { opacity: 0.3; }
        100% { opacity: 0.8; }
      }

      /* Spikes */
      .spike {
        position: absolute;
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-bottom: 20px solid #8b0000;
        filter: drop-shadow(0 2px 4px rgba(139, 0, 0, 0.5));
        animation: spikeGlow 2s ease-in-out infinite alternate;
      }

      @keyframes spikeGlow {
        0% { filter: drop-shadow(0 2px 4px rgba(139, 0, 0, 0.5)); }
        100% { filter: drop-shadow(0 2px 8px rgba(139, 0, 0, 0.9)) brightness(1.2); }
      }

      /* Moving Platforms */
      .moving-platform {
        background: linear-gradient(45deg, #1a472a, #2e7d32);
        border: 2px solid #4caf50;
        animation: platformMove 8s ease-in-out infinite;
      }

      @keyframes platformMove {
        0%, 100% { transform: translateX(0); }
        50% { transform: translateX(200px); }
      }

      /* Collectible Orbs */
      .orb {
        position: absolute;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #ffd700, #ffb347, #ff6347);
        animation: orbFloat 4s ease-in-out infinite, orbGlow 2s ease-in-out infinite alternate;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
      }

      @keyframes orbFloat {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-15px) rotate(180deg); }
      }

      @keyframes orbGlow {
        0% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
        100% { box-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 40px rgba(255, 215, 0, 0.4); }
      }

      /* Lava/Danger Zones */
      .lava {
        position: absolute;
        background: linear-gradient(45deg, #ff4500, #dc143c, #8b0000);
        background-size: 20px 20px;
        animation: lavaFlow 3s linear infinite;
        border-top: 3px solid #ff6347;
        box-shadow: 0 -5px 15px rgba(255, 69, 0, 0.5);
      }

      @keyframes lavaFlow {
        0% { background-position: 0 0; }
        100% { background-position: 20px 20px; }
      }

      /* Floating Islands */
      .floating-island {
        position: absolute;
        background: linear-gradient(45deg, #654321, #8b4513);
        border-radius: 50px 50px 20px 20px;
        border: 2px solid #a0522d;
        animation: islandFloat 6s ease-in-out infinite;
        box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      }

      .floating-island::after {
        content: '';
        position: absolute;
        top: -5px;
        left: 10%;
        right: 10%;
        height: 8px;
        background: linear-gradient(90deg, transparent, #228b22, transparent);
        border-radius: 4px;
      }

      @keyframes islandFloat {
        0%, 100% { transform: translateY(0) rotate(-1deg); }
        50% { transform: translateY(-20px) rotate(1deg); }
      }

      /* Background Stars/Particles */
      .bg-star {
        position: absolute;
        width: 2px;
        height: 2px;
        background: #fff;
        border-radius: 50%;
        animation: starTwinkle 3s ease-in-out infinite;
      }

      @keyframes starTwinkle {
        0%, 100% { opacity: 0.3; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.5); }
      }

      /* Chains and Hanging Platforms */
      .chain {
        position: absolute;
        width: 4px;
        background: repeating-linear-gradient(
          to bottom,
          #696969 0px,
          #696969 8px,
          #2f2f2f 8px,
          #2f2f2f 16px
        );
        animation: chainSway 4s ease-in-out infinite;
      }

      @keyframes chainSway {
        0%, 100% { transform: rotate(-2deg); }
        50% { transform: rotate(2deg); }
      }

      .hanging-platform {
        position: absolute;
        background: linear-gradient(45deg, #8b4513, #a0522d);
        border: 2px solid #daa520;
        border-radius: 8px;
        animation: hangingSwing 5s ease-in-out infinite;
      }

      @keyframes hangingSwing {
        0%, 100% { transform: rotate(-3deg); }
        50% { transform: rotate(3deg); }
      }

      .game-container {
        position: relative;
        width: 960px;
        height: 600px;
        max-width: 95vw;
        max-height: 95vh;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        background: #0d0d0d;
        border: 2px solid rgba(139, 0, 0, 0.3);
        transition: all 0.3s ease;
      }

      .game-container.fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        max-width: none;
        max-height: none;
        border-radius: 0;
        z-index: 9999;
        border: none;
      }

      #unity-canvas {
        width: 100%;
        height: 100%;
        display: block;
        border-radius: 16px;
      }

      /* Loading Overlay */
      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #1a0000 0%, #2d0000 50%, #1a0000 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        transition: opacity 0.5s ease, visibility 0.5s ease;
      }

      .loading-overlay.hidden {
        opacity: 0;
        visibility: hidden;
      }

      /* Game Logo */
      .game-logo {
        font-size: 3rem;
        font-weight: 700;
        color: white;
        margin-bottom: 2rem;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.8), 0 0 20px rgba(139, 0, 0, 0.3);
        animation: glow 2s ease-in-out infinite alternate;
      }

      @keyframes glow {
        from { text-shadow: 0 4px 8px rgba(0, 0, 0, 0.8), 0 0 20px rgba(139, 0, 0, 0.3); }
        to { text-shadow: 0 4px 8px rgba(0, 0, 0, 0.8), 0 0 30px rgba(139, 0, 0, 0.6); }
      }

      /* Loading Spinner */
      .loading-spinner {
        width: 60px;
        height: 60px;
        margin-bottom: 2rem;
        position: relative;
      }

      .spinner-ring {
        width: 100%;
        height: 100%;
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-top: 4px solid #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Progress Bar */
      .progress-container {
        width: 300px;
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 1rem;
        backdrop-filter: blur(10px);
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #8b0000, #cd5c5c);
        border-radius: 4px;
        transition: width 0.3s ease;
        box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
        animation: progressGlow 2s ease-in-out infinite alternate;
      }

      @keyframes progressGlow {
        from { box-shadow: 0 0 20px rgba(139, 0, 0, 0.5); }
        to { box-shadow: 0 0 30px rgba(139, 0, 0, 0.8); }
      }

      /* Loading Text */
      .loading-text {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        text-align: center;
      }

      .loading-details {
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.875rem;
        text-align: center;
      }

      /* Error State */
      .error-message {
        color: #ff6b6b;
        background: rgba(255, 107, 107, 0.1);
        padding: 1rem 2rem;
        border-radius: 8px;
        border: 1px solid rgba(255, 107, 107, 0.2);
        text-align: center;
        font-weight: 600;
        margin-top: 1rem;
        backdrop-filter: blur(10px);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .game-container {
          width: 100vw;
          height: 100vh;
          border-radius: 0;
          max-width: none;
          max-height: none;
        }

        #unity-canvas {
          border-radius: 0;
        }

        .game-logo {
          font-size: 2rem;
          margin-bottom: 1.5rem;
        }

        .progress-container {
          width: 250px;
        }

        body {
          background: #0d0d0d;
        }
      }

      /* Floating Particles Background */
      .particles {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        overflow: hidden;
      }

      .particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: rgba(139, 0, 0, 0.2);
        border-radius: 50%;
        animation: float 8s ease-in-out infinite;
      }

      @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0; }
        50% { opacity: 0.3; }
        100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
      }

      /* Fullscreen Controls */
      .fullscreen-controls {
        position: absolute;
        top: 15px;
        right: 15px;
        z-index: 2000;
        display: flex;
        gap: 10px;
      }

      .control-btn {
        background: rgba(0, 0, 0, 0.7);
        border: 1px solid rgba(139, 0, 0, 0.5);
        color: white;
        border-radius: 8px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .control-btn:hover {
        background: rgba(139, 0, 0, 0.3);
        border-color: rgba(139, 0, 0, 0.8);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(139, 0, 0, 0.3);
      }

      .control-btn:active {
        transform: translateY(0);
      }

      /* Dark overlay effect for low visibility */
      .game-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at center, transparent 30%, rgba(0, 0, 0, 0.4) 100%);
        pointer-events: none;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <!-- Complex Animated Platformer Background -->
    <div class="platformer-bg">
      <!-- Generate complex platformer level in background -->
    </div>

    <div class="game-container" id="game-container">
      <!-- Fullscreen Controls -->
      <div class="fullscreen-controls">
        <button class="control-btn" onclick="toggleFullscreen()" id="fullscreen-btn">
          ⛶ Fullscreen
        </button>
        <button class="control-btn" onclick="toggleLowVisibility()" id="visibility-btn">
          👁 Toggle Visibility
        </button>
      </div>
      
      <!-- Unity Canvas -->
      <canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>
      
      <!-- Loading Overlay -->
      <div id="loading-overlay" class="loading-overlay">
        <div class="particles">
          <!-- Particles will be generated by JavaScript -->
        </div>
        
        <div class="game-logo">BISKUT</div>
        
        <div class="loading-spinner">
          <div class="spinner-ring"></div>
        </div>
        
        <div class="progress-container">
          <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
        </div>
        
        <div id="loading-text" class="loading-text">Initializing...</div>
        <div id="loading-details" class="loading-details">Preparing the BISKUT</div>
        
        <div id="error-message" class="error-message" style="display: none;"></div>
      </div>
    </div>

    <script src="Build/chaosBuild.loader.js"></script>
    <script>
      // Create complex animated platformer background
      function createPlatformerBackground() {
        const bg = document.querySelector('.platformer-bg');
        
        // Create multiple layers of platforms
        const platforms = [
          { x: 100, y: 500, width: 200, height: 20 },
          { x: 400, y: 400, width: 150, height: 20 },
          { x: 700, y: 300, width: 180, height: 20 },
          { x: 200, y: 200, width: 160, height: 20 },
          { x: 500, y: 600, width: 220, height: 20 },
          { x: 800, y: 550, width: 140, height: 20 },
          { x: 50, y: 350, width: 120, height: 20 },
          { x: 600, y: 150, width: 200, height: 20 },
          { x: 300, y: 700, width: 180, height: 20 },
          { x: 750, y: 100, width: 160, height: 20 }
        ];

        platforms.forEach((plat, i) => {
          const platform = document.createElement('div');
          platform.className = i % 3 === 0 ? 'platform moving-platform' : 'platform';
          platform.style.left = plat.x + 'px';
          platform.style.top = plat.y + 'px';
          platform.style.width = plat.width + 'px';
          platform.style.height = plat.height + 'px';
          bg.appendChild(platform);
        });

        // Add floating islands
        const islands = [
          { x: 150, y: 100, width: 80, height: 40 },
          { x: 450, y: 250, width: 100, height: 50 },
          { x: 650, y: 450, width: 90, height: 45 },
          { x: 850, y: 200, width: 110, height: 55 }
        ];

        islands.forEach(island => {
          const floatingIsland = document.createElement('div');
          floatingIsland.className = 'floating-island';
          floatingIsland.style.left = island.x + 'px';
          floatingIsland.style.top = island.y + 'px';
          floatingIsland.style.width = island.width + 'px';
          floatingIsland.style.height = island.height + 'px';
          bg.appendChild(floatingIsland);
        });

        // Add spikes on platforms
        const spikePositions = [
          { x: 420, y: 380 }, { x: 440, y: 380 }, { x: 460, y: 380 },
          { x: 720, y: 280 }, { x: 740, y: 280 },
          { x: 520, y: 580 }, { x: 540, y: 580 }, { x: 560, y: 580 }
        ];

        spikePositions.forEach(pos => {
          const spike = document.createElement('div');
          spike.className = 'spike';
          spike.style.left = pos.x + 'px';
          spike.style.top = pos.y + 'px';
          bg.appendChild(spike);
        });

        // Add collectible orbs
        const orbPositions = [
          { x: 180, y: 170 }, { x: 480, y: 370 }, { x: 780, y: 270 },
          { x: 280, y: 170 }, { x: 680, y: 120 }, { x: 580, y: 570 },
          { x: 130, y: 320 }, { x: 380, y: 670 }
        ];

        orbPositions.forEach((pos, i) => {
          const orb = document.createElement('div');
          orb.className = 'orb';
          orb.style.left = pos.x + 'px';
          orb.style.top = pos.y + 'px';
          orb.style.animationDelay = (i * 0.5) + 's';
          bg.appendChild(orb);
        });

        // Add lava zones
        const lavaZones = [
          { x: 0, y: 750, width: 300, height: 50 },
          { x: 400, y: 800, width: 250, height: 40 },
          { x: 700, y: 780, width: 300, height: 60 }
        ];

        lavaZones.forEach(lava => {
          const lavaZone = document.createElement('div');
          lavaZone.className = 'lava';
          lavaZone.style.left = lava.x + 'px';
          lavaZone.style.top = lava.y + 'px';
          lavaZone.style.width = lava.width + 'px';
          lavaZone.style.height = lava.height + 'px';
          bg.appendChild(lavaZone);
        });

        // Add hanging platforms with chains
        const hangingPlatforms = [
          { chainX: 350, chainY: 50, chainHeight: 120, platX: 335, platY: 170, platWidth: 30, platHeight: 15 },
          { chainX: 550, chainY: 80, chainHeight: 100, platX: 535, platY: 180, platWidth: 30, platHeight: 15 },
          { chainX: 750, chainY: 30, chainHeight: 140, platX: 735, platY: 170, platWidth: 30, platHeight: 15 }
        ];

        hangingPlatforms.forEach(hanging => {
          // Create chain
          const chain = document.createElement('div');
          chain.className = 'chain';
          chain.style.left = hanging.chainX + 'px';
          chain.style.top = hanging.chainY + 'px';
          chain.style.height = hanging.chainHeight + 'px';
          bg.appendChild(chain);

          // Create hanging platform
          const platform = document.createElement('div');
          platform.className = 'hanging-platform';
          platform.style.left = hanging.platX + 'px';
          platform.style.top = hanging.platY + 'px';
          platform.style.width = hanging.platWidth + 'px';
          platform.style.height = hanging.platHeight + 'px';
          bg.appendChild(platform);
        });

        // Add background stars
        for (let i = 0; i < 50; i++) {
          const star = document.createElement('div');
          star.className = 'bg-star';
          star.style.left = Math.random() * 1000 + 'px';
          star.style.top = Math.random() * 800 + 'px';
          star.style.animationDelay = Math.random() * 3 + 's';
          bg.appendChild(star);
        }
      }

      // Create floating particles for loading screen
      function createParticles() {
        const particlesContainer = document.querySelector('.particles');
        for (let i = 0; i < 15; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.animationDelay = Math.random() * 8 + 's';
          particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
          particlesContainer.appendChild(particle);
        }
      }

      // Fullscreen functionality
      function toggleFullscreen() {
        const gameContainer = document.getElementById('game-container');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        
        if (!gameContainer.classList.contains('fullscreen')) {
          gameContainer.classList.add('fullscreen');
          fullscreenBtn.innerHTML = '⛶ Exit Fullscreen';
          
          // Also request browser fullscreen
          if (gameContainer.requestFullscreen) {
            gameContainer.requestFullscreen();
          } else if (gameContainer.webkitRequestFullscreen) {
            gameContainer.webkitRequestFullscreen();
          } else if (gameContainer.msRequestFullscreen) {
            gameContainer.msRequestFullscreen();
          }
        } else {
          gameContainer.classList.remove('fullscreen');
          fullscreenBtn.innerHTML = '⛶ Fullscreen';
          
          // Exit browser fullscreen
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          }
        }
      }

      // Low visibility toggle
      let lowVisibility = false;
      function toggleLowVisibility() {
        const gameContainer = document.getElementById('game-container');
        const visibilityBtn = document.getElementById('visibility-btn');
        
        lowVisibility = !lowVisibility;
        
        if (lowVisibility) {
          gameContainer.style.filter = 'brightness(0.3) contrast(0.8)';
          visibilityBtn.innerHTML = '👁 Normal Visibility';
        } else {
          gameContainer.style.filter = 'none';
          visibilityBtn.innerHTML = '👁 Low Visibility';
        }
      }

      // Listen for fullscreen changes
      document.addEventListener('fullscreenchange', function() {
        const gameContainer = document.getElementById('game-container');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        
        if (!document.fullscreenElement) {
          gameContainer.classList.remove('fullscreen');
          fullscreenBtn.innerHTML = '⛶ Fullscreen';
        }
      });

      // Mobile device detection and setup
      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        const canvas = document.querySelector("#unity-canvas");
        const container = document.querySelector(".game-container");
        
        container.style.width = "100vw";
        container.style.height = "100vh";
        container.style.borderRadius = "0";
        container.style.maxWidth = "none";
        container.style.maxHeight = "none";
        
        canvas.style.borderRadius = "0";
        document.body.style.textAlign = "left";
        document.body.style.background = "#0d0d0d";
      }

      // Loading progress tracking
      const progressBar = document.getElementById('progress-bar');
      const loadingText = document.getElementById('loading-text');
      const loadingDetails = document.getElementById('loading-details');
      const errorMessage = document.getElementById('error-message');
      const loadingOverlay = document.getElementById('loading-overlay');

      const loadingMessages = [
        { text: "Initializing...", detail: "Preparing the chaos" },
        { text: "Loading framework...", detail: "Setting up the game engine" },
        { text: "Loading assets...", detail: "Downloading game data" },
        { text: "Compiling code...", detail: "Preparing WebAssembly" },
        { text: "Almost ready...", detail: "Final preparations" }
      ];

      let currentMessageIndex = 0;

      function updateLoadingMessage(progress) {
        const messageIndex = Math.min(Math.floor(progress * loadingMessages.length / 100), loadingMessages.length - 1);
        if (messageIndex !== currentMessageIndex) {
          currentMessageIndex = messageIndex;
          loadingText.textContent = loadingMessages[messageIndex].text;
          loadingDetails.textContent = loadingMessages[messageIndex].detail;
        }
      }

      // Create complex platformer background and particles effect
      createPlatformerBackground();
      createParticles();

      // Unity instance creation with progress tracking
      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/chaosBuild.data",
        frameworkUrl: "Build/chaosBuild.framework.js",
        codeUrl: "Build/chaosBuild.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "The Chaos",
        productVersion: "1.0"
      }, (progress) => {
        // Update progress bar
        const percentage = Math.round(progress * 100);
        progressBar.style.width = percentage + '%';
        updateLoadingMessage(percentage);
        
        console.log(`Loading progress: ${percentage}%`);
      }).then((unityInstance) => {
        // Game loaded successfully
        console.log('Unity game loaded successfully');
        setTimeout(() => {
          loadingOverlay.classList.add('hidden');
        }, 500);
      }).catch((error) => {
        // Handle loading errors
        console.error('Unity loading error:', error);
        errorMessage.textContent = 'Failed to load the game. Please refresh and try again.';
        errorMessage.style.display = 'block';
        
        // Hide loading elements
        document.querySelector('.loading-spinner').style.display = 'none';
        document.querySelector('.progress-container').style.display = 'none';
        loadingText.style.display = 'none';
        loadingDetails.style.display = 'none';
      });
    </script>